# План оптимизации производительности сайта

## Проблема
Запросы блокируют обработку при первоначальной загрузке страницы, что приводит к увеличению LCP (Largest Contentful Paint) и FCP (First Contentful Paint).

**Текущая ситуация:**
- 7 CSS chunks загружаются синхронно
- Общий объем: ~289 KB CSS
- Время загрузки: ~10.36 секунд
- Самые большие файлы:
  - main.css: 792.95 KB (компилированный)
  - font-awesome-pro.min.css: 499.98 KB
  - bootstrap.min.css: 227.49 KB
  - shop.css: 193.28 KB

## План оптимизации

### 1. Критический CSS (Critical CSS) - Приоритет: ВЫСОКИЙ
**Цель:** Инлайнить критический CSS в `<head>` для мгновенного рендеринга

**Действия:**
- Извлечь критический CSS для above-the-fold контента (header, hero, первые секции)
- Добавить критический CSS напрямую в `<head>` через `<style>` тег
- Остальной CSS загружать асинхронно

**Ожидаемый эффект:** Уменьшение FCP на 40-60%

### 2. Отложенная загрузка некритичных стилей - Приоритет: ВЫСОКИЙ
**Цель:** Не блокировать рендеринг некритичными CSS файлами

**Действия:**
- Переместить некритичные CSS в динамические импорты
- Использовать `next/dynamic` для компонентов, которые не видны сразу
- Загружать CSS для модалок, слайдеров, анимаций после первого рендера

**Файлы для отложенной загрузки:**
- `glightbox.min.css` (модалки)
- `animate.min.css` (анимации)
- `swiper/css/*` (слайдеры - загружать только когда нужны)
- `nice-select2.css` (селекты)
- `odometer-theme-default.css` (счетчики)

**Ожидаемый эффект:** Уменьшение времени блокировки на 30-50%

### 3. Оптимизация Font Awesome - Приоритет: ВЫСОКИЙ
**Цель:** Уменьшить размер font-awesome-pro.min.css (499.98 KB)

**Действия:**
- Использовать только нужные иконки вместо полного набора
- Перейти на tree-shaking версию Font Awesome
- Или использовать только SVG иконки для критичных элементов
- Загружать Font Awesome асинхронно

**Ожидаемый эффект:** Экономия ~400-450 KB

### 4. Оптимизация Bootstrap - Приоритет: СРЕДНИЙ
**Цель:** Использовать только нужные компоненты Bootstrap

**Действия:**
- Анализировать, какие компоненты Bootstrap реально используются
- Использовать Bootstrap через tree-shaking (bootstrap/dist/css/bootstrap-grid.min.css если нужна только сетка)
- Или заменить на более легкую альтернативу (например, только CSS Grid/Flexbox)

**Ожидаемый эффект:** Экономия ~150-200 KB

### 5. Оптимизация main.css - Приоритет: ВЫСОКИЙ
**Цель:** Уменьшить размер основного CSS файла

**Действия:**
- Удалить неиспользуемые стили (PurgeCSS)
- Разделить main.css на модули:
  - `critical.css` - критичные стили (inline)
  - `layout.css` - стили макета
  - `components.css` - стили компонентов
  - `utilities.css` - утилиты
- Загружать модули по требованию

**Ожидаемый эффект:** Уменьшение размера на 30-50%

### 6. Оптимизация shop.css - Приоритет: НИЗКИЙ
**Цель:** Загружать только когда нужен

**Действия:**
- Загружать shop.css только на страницах магазина/продуктов
- Использовать динамический импорт в компонентах магазина

**Ожидаемый эффект:** Экономия ~193 KB на главной странице

### 7. Использование preload/prefetch - Приоритет: СРЕДНИЙ
**Цель:** Предзагружать критичные ресурсы

**Действия:**
- Добавить `<link rel="preload">` для критичных CSS
- Использовать `<link rel="prefetch">` для некритичных CSS
- Оптимизировать порядок загрузки

### 8. Оптимизация шрифтов - Приоритет: СРЕДНИЙ
**Цель:** Улучшить загрузку шрифтов

**Действия:**
- Уже используется `display: "swap"` - хорошо
- Рассмотреть использование только нужных весов шрифта (сейчас 200-900)
- Использовать font-display: swap в CSS

### 9. Code Splitting для CSS - Приоритет: СРЕДНИЙ
**Цель:** Разделить CSS по страницам/роутам

**Действия:**
- Использовать CSS Modules для компонентов
- Загружать стили страниц только на соответствующих страницах
- Next.js автоматически делает code splitting, но нужно правильно организовать импорты

### 10. Минификация и сжатие - Приоритет: НИЗКИЙ
**Цель:** Убедиться, что все CSS минифицированы

**Действия:**
- Проверить, что production build минифицирует CSS
- Убедиться, что включено gzip/brotli сжатие на сервере
- Оптимизировать next.config.js для лучшей компрессии

## Приоритетный порядок выполнения

### Фаза 1 (Быстрые победы - 1-2 дня):
1. ✅ Отложенная загрузка некритичных CSS (glightbox, animate, swiper)
2. ✅ Оптимизация Font Awesome (tree-shaking или замена)
3. ✅ Добавление критического CSS inline

### Фаза 2 (Средний приоритет - 3-5 дней):
4. ✅ Оптимизация main.css (PurgeCSS, разделение на модули)
5. ✅ Оптимизация Bootstrap (tree-shaking)
6. ✅ Code splitting для shop.css

### Фаза 3 (Долгосрочные улучшения - 1-2 недели):
7. ✅ Полная реорганизация CSS структуры
8. ✅ Оптимизация всех компонентов
9. ✅ Настройка preload/prefetch

## Ожидаемые результаты

**После Фазы 1:**
- Уменьшение блокирующих CSS с 289 KB до ~150 KB
- Улучшение FCP на 40-50%
- Улучшение LCP на 30-40%

**После Фазы 2:**
- Уменьшение блокирующих CSS до ~80-100 KB
- Улучшение FCP на 60-70%
- Улучшение LCP на 50-60%

**После Фазы 3:**
- Оптимальная загрузка CSS
- FCP < 1.5 секунды
- LCP < 2.5 секунды

## Технические детали

### Текущая структура загрузки CSS:
```
layout.js:
├── react-range-slider-input/dist/style.css (синхронно)
├── swiper/css/* (6 файлов, синхронно)
├── animate.min.css (синхронно)
├── bexon-icons.css (синхронно)
├── bootstrap.min.css (синхронно)
├── font-awesome-pro.min.css (синхронно)
├── glightbox.min.css (синхронно)
├── meanmenu.css (синхронно)
├── nice-select2.css (синхронно)
├── odometer-theme-default.css (синхронно)
└── globals.css
    ├── meanmenu.css (@import)
    ├── main.css (@import, 792 KB)
    └── shop.css (@import, 193 KB)
```

### Рекомендуемая структура:
```
layout.js:
├── critical.css (inline в <head>)
└── globals.css (только базовые стили)

Динамические импорты:
├── Компоненты со слайдерами → загружают swiper/css
├── Компоненты с модалками → загружают glightbox.min.css
├── Компоненты с анимациями → загружают animate.min.css
└── Страницы магазина → загружают shop.css
```

## Инструменты для реализации

1. **PurgeCSS** - удаление неиспользуемого CSS
2. **critical** (npm) - извлечение критического CSS
3. **next/dynamic** - динамические импорты
4. **@next/bundle-analyzer** - анализ размера бандла
5. **Lighthouse CI** - мониторинг производительности

## Метрики для отслеживания

- **FCP (First Contentful Paint)**: Цель < 1.5s
- **LCP (Largest Contentful Paint)**: Цель < 2.5s
- **TBT (Total Blocking Time)**: Цель < 200ms
- **CLS (Cumulative Layout Shift)**: Цель < 0.1
- **Размер CSS**: Цель < 100 KB критичного CSS

